{# File: show_post.html #}
{# Author: Artemios Kayas (akayas@bu.edu) #}
{# Description: Show a single post with its details and all associated photos #}
{% extends "mini_insta/base.html" %}

{% block content %}
<div class="post-detail-container">
    <div class="post-header">
        <h1>Post by <a href="{% url 'show_profile' post.profile.pk %}">{{ post.profile.display_name }}</a></h1>
        <p class="post-timestamp">Posted on {{ post.timestamp }}</p>
    </div>
    
    <div class="post-content">
        <div class="post-likes">
            <p><strong>{{ post.get_likes.count }} likes</strong></p>
            {% if user.is_authenticated and logged_in_profile %}
                {# Don't allow liking your own post #}
                {% if post.profile != logged_in_profile %}
                    {% if is_liked %}
                        <p><a href="{% url 'unlike_post' post.pk %}"><button>Unlike</button></a></p>
                    {% else %}
                        <p><a href="{% url 'like_post' post.pk %}"><button>Like</button></a></p>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>

        <div class="post-caption">
            <h2>{{ post.caption }}</h2>
        </div>

        <div class="post-photos">
            <h3>Photos:</h3>
            {% for photo in post.get_all_photos %}
                <div class="photo-item">
                    <img src="{{ photo.get_image_url }}" alt="{{ post.caption }}" class="post-photo">
                </div>
            {% empty %}
                <p>No photos available for this post.</p>
            {% endfor %}
        </div>

        <div class="post-comments">
            <h3>Comments:</h3>
            {% for comment in post.get_all_comments %}
                <div class="comment-item">
                    <p><strong><a href="{% url 'show_profile' comment.profile.pk %}">{{ comment.profile.display_name }}</a>:</strong> {{ comment.text }}</p>
                    <p class="comment-timestamp">{{ comment.timestamp }}</p>
                </div>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}
        </div>
    </div>
    
    <div class="post-actions">
        <a href="{% url 'show_profile' post.profile.pk %}" class="back-link">Back to {{ post.profile.display_name }}'s Profile</a>
        {% if user.is_authenticated and post.profile.user == user %}
            <a href="{% url 'update_post' post.pk %}">Update</a>
            <a href="{% url 'delete_post' post.pk %}">Delete</a>
        {% endif %}
    </div>
</div>
{% endblock %}
