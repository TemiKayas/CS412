{# File: show_feed.html #}
{# Author: Artemios Kayas (akayas@bu.edu) #}
{# Description: Show the post feed for a profile #}
{% extends "mini_insta/base.html" %}

{% block content %}
<h1 style="text-align: center;">Post Feed for {{ profile.display_name }}</h1>

<div class="feed-container">
    <p><a href="{% url 'show_profile' profile.pk %}">Back to Profile</a></p>

    {% if posts %}
        {% for post in posts %}
            <div class="feed-post">
                <div class="post-header">
                    <img src="{{ post.profile.profile_image_url }}" alt="{{ post.profile.display_name }}" style="width: 50px; height: 50px; border-radius: 50%;">
                    <h3><a href="{% url 'show_profile' post.profile.pk %}">{{ post.profile.display_name }}</a></h3>
                    <p class="post-timestamp">{{ post.timestamp }}</p>
                </div>

                <div class="post-content">
                    {% with first_photo=post.get_all_photos.first %}
                        {% if first_photo %}
                            <a href="{% url 'show_post' post.pk %}">
                                <img src="{{ first_photo.get_image_url }}" alt="{{ post.caption }}" class="feed-photo">
                            </a>
                        {% endif %}
                    {% endwith %}

                    <div class="post-info">
                        <p><strong>{{ post.get_likes.count }} likes</strong></p>
                        <p><strong><a href="{% url 'show_profile' post.profile.pk %}">{{ post.profile.display_name }}</a>:</strong> {{ post.caption }}</p>

                        <div class="post-comments">
                            {% for comment in post.get_all_comments %}
                                <p><strong><a href="{% url 'show_profile' comment.profile.pk %}">{{ comment.profile.display_name }}</a>:</strong> {{ comment.text }}</p>
                            {% endfor %}
                        </div>

                        <p><a href="{% url 'show_post' post.pk %}">View Post</a></p>
                    </div>
                </div>
            </div>
            <hr>
        {% endfor %}
    {% else %}
        <p>No posts in your feed yet. Follow some profiles to see their posts!</p>
    {% endif %}
</div>
{% endblock %}
